import { LinkIcon } from '@heroicons/react/20/solid'

import { getLevelImage } from '@/utils'

function Hr () {
  return (
    <hr className='my-2' />
  )
}

function ExtLink ({ href }) {
  return (
    <a href={href} target='_blank' rel='noreferrer'>
      <LinkIcon
        className='w-4 h-4 mr-2'
      />
    </a>

  )
}

function SectionTitle ({ title }) {
  return (
    <div className='font-bold text-slate-600'>
      {title}
    </div>
  )
}

export default function VulnerabilityPane ({ vulnerability }) {
  return (
    <div className='flex flex-col items-stretch flex-1 p-2'>
      <div className='flex items-center h-12 mb-3'>
        <img
          className='object-contain h-full'
          src={getLevelImage(vulnerability.level.id)}
          alt={vulnerability.level.name}
        />
        <div className='pl-2'>
          <div className='text-sm text-slate-500'>{vulnerability.level.name}</div>
          <div className='text-xl font-bold text-slate-800'>{vulnerability.name}</div>
        </div>

      </div>
      <div>
        {vulnerability.description}
      </div>
      <Hr />
      {vulnerability.categories.length > 0 &&
        <>
          <div className='flex flex-col'>
            <SectionTitle title='Categories' />
            <ul>
              {vulnerability.categories.map(category => (
                <li key={category.id}>{`\u2022 ${category.name}`}</li>
              ))}
            </ul>
          </div>
          <Hr />
        </>}
      {vulnerability.cwes.length > 0 &&
        <>
          <div className='flex flex-col'>
            <SectionTitle title='CWEs' />
            {vulnerability.cwes.map(cwe => (
              <div key={cwe.id} className='flex items-center'>
                <ExtLink href={`https://cwe.mitre.org/data/definitions/${cwe.weakness_id}`} />
                <div>{cwe.name}</div>
              </div>
            ))}
          </div>
          <Hr />
        </>}
      {vulnerability.swcs.length > 0 &&
        <>
          <div className='flex flex-col'>
            <SectionTitle title='SWCs' />
            {vulnerability.swcs.map(swc => (
              <div key={swc.id} className='flex items-center'>
                <ExtLink href={`https://swcregistry.io/docs/SWC-${swc.weakness_id}`} />
                <div>{swc.name}</div>
              </div>
            ))}
          </div>
          <Hr />
        </>}
      {vulnerability.mitigations.length > 0 &&
        <>
          <div className='flex flex-col'>
            <SectionTitle title='Mitigations' />
            {vulnerability.mitigations.map(mitigation => (
              <div key={mitigation.id} className='flex flex-col'>
                <div>{`\u2022 ${mitigation.name}`}</div>
                <div className='pl-3 text-sm italic text-slate-800'>{mitigation.description}</div>
              </div>
            ))}
          </div>
          <Hr />
        </>}
      {vulnerability.attacks.length > 0 &&
        <>
          <div className='flex flex-col'>
            <SectionTitle title='Attacks' />
            {vulnerability.attacks.map(attack => (
              <div key={attack.id} className='flex flex-col'>
                <div>
                  <span className=''>{`\u2022 ${attack.name}, `}</span>
                  <span className='italic text-slate-600'>{`(${attack.year})`}</span>
                </div>
                {attack.references.map(ref => (
                  <div key={ref.id} className='flex items-center pl-4 text-sm'>
                    <ExtLink href={ref.bibtexJson.entryTags.url} />
                    <div className='italic text-slate-600'>{ref.citation}</div>
                  </div>
                ))}
              </div>
            ))}
          </div>
          <Hr />
        </>}
      {vulnerability.tools.length > 0 &&
        <>
          <div className='flex flex-col'>
            <SectionTitle title='Tools' />
            {vulnerability.tools.map(tool => (
              <div key={tool.id} className='flex flex-col py-1'>
                <div className='flex justify-between text-sm'>
                  <span>
                    <span className='font-mono'>{`\u2022 ${tool.name},`}</span>
                    <span className='italic text-slate-600'>{`(${tool.year})`}</span>
                  </span>
                  <span className='font-bold text-slate-800' style={{ fontVariant: 'small-caps' }}>{tool.type}</span>
                </div>
                {tool.references.map(ref => (
                  <div key={ref.id} className='flex items-center pl-4 text-sm'>
                    <ExtLink href={ref.bibtexJson.entryTags.url} />
                    <div className='italic text-slate-600'>{ref.citation}</div>
                  </div>
                ))}
              </div>
            ))}
          </div>
          <Hr />
        </>}
      {vulnerability.references.length > 0 &&
        <>
          <div className='flex flex-col'>
            <SectionTitle title='References' />
            {vulnerability.references.map(ref => (
              <div key={ref.id} className='flex items-center py-1 text-sm'>
                <ExtLink href={ref.bibtexJson.entryTags.url} />
                <div className='flex flex-col'>
                  <div className='italic text-slate-600'>{ref.citation}</div>
                  <div>{ref.title}</div>
                  <div className='pl-4 italic text-slate-600'>{`Alias: ${ref.alias}`}</div>
                </div>
              </div>
            ))}
          </div>
          <Hr />
        </>}
    </div>
  )
}
